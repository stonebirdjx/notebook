<!-- START doctoc generated TOC please keep comment here to allow auto update -->
<!-- DON'T EDIT THIS SECTION, INSTEAD RE-RUN doctoc TO UPDATE -->
**Table of Contents**  *generated with [DocToc](https://github.com/thlorenz/doctoc)*

- [简介](#%E7%AE%80%E4%BB%8B)
- [架构图](#%E6%9E%B6%E6%9E%84%E5%9B%BE)
- [名词解释](#%E5%90%8D%E8%AF%8D%E8%A7%A3%E9%87%8A)
- [:point_right:底层规划](#point_right%E5%BA%95%E5%B1%82%E8%A7%84%E5%88%92)
- [:point_right:离线(私有)源](#point_right%E7%A6%BB%E7%BA%BF%E7%A7%81%E6%9C%89%E6%BA%90)
- [:point_right:高可用系统设计](#point_right%E9%AB%98%E5%8F%AF%E7%94%A8%E7%B3%BB%E7%BB%9F%E8%AE%BE%E8%AE%A1)
- [:point_right:IAM访问控制](#point_rightiam%E8%AE%BF%E9%97%AE%E6%8E%A7%E5%88%B6)
- [:point_right:TOP网关服务](#point_righttop%E7%BD%91%E5%85%B3%E6%9C%8D%E5%8A%A1)
- [:point_right:容器服务](#point_right%E5%AE%B9%E5%99%A8%E6%9C%8D%E5%8A%A1)
- [:point_right:观测分析](#point_right%E8%A7%82%E6%B5%8B%E5%88%86%E6%9E%90)
- [:point_right:CDN内容分发](#point_rightcdn%E5%86%85%E5%AE%B9%E5%88%86%E5%8F%91)
- [:point_right:应用侧](#point_right%E5%BA%94%E7%94%A8%E4%BE%A7)

<!-- END doctoc generated TOC please keep comment here to allow auto update -->

# 简介

成为一名架构师之前，你需要先成为一名合格的开发者，需要掌握一门编程语言、需要熟练使用linux、容器、镜像仓、代码仓，数据库、消息队列等。[点击查阅100分的程序员](https://github.com/stonebirdjx)

软件设计原则：*可读性、可维护、安全、可靠、可测试、高效、可移植*。

目标：体验一致、可持续发展、低耦合、可扩展、轻量、统一运

包括但不限于以下方面

> 毒鸡汤：车马春山慢慢行

# 架构图

![](https://github.com/stonebirdjx/static/blob/master/notebook/jg_20230325184401.png)

> 完美切合DDD 领域驱动

# 名词解释

| 术语    | 解释                                                         |
| ------- | ------------------------------------------------------------ |
| MetalLB | 支持通过k8s原生的方式提供LoadBalancer类型的Service，直接访问容器内部端口。 |
| HA      | 高可用                                                       |
| VM      | 虚拟机                                                       |
| VIP     | 虚拟ip                                                       |
| QPS     | “每秒查询率”，是一台服务器每秒能够相应的查询次数，是对一个特定的查询服务器在规定时间内所处理流量多少的衡量标准。 |
| TPS     | 每秒处理事务数，包括了：用户请求服务器、服务器自己的内部处理（数据库、消息队列）、服务器返回给用户 |

# :point_right:底层规划

架构第一步就是做好底层规划，设备要求：物理机、虚拟机、交换机（TOR、BMC）。功能包括但不限于

- 操作系统：centos、ubuntu、debian、redhat、kylin、openEuler、CGSL...
- CPU架构：x86、arm
- GPU型号(cuda驱动)：T4、A100、V100
- 平台服务：数据平台服务（DataLeap..）、AI平台服务（视频AI、AutoML）、视频服务、敏捷开发
- 云服务：可提供计算、网络、存储（块存储、对象存储）、数据库、中间件、云原生PaaS（容器服务、镜像仓、持续交付CI/CP）、云原生计算、安全，容器服务。
- 安全管理：提供覆盖终端、网络、数据的端到端安全云服务（Ddos、防火墙）
- 云管平台：数据中心级的统一运营运维平台，软件管理，单点登录SSO
- 运维：可观测性分析（RPC连接、接口监控、上下游调用、消息队列MQ、数据库、告警上报）

> 切记：规划设备时要根据业务需要做好容灾处理。

# :point_right:离线(私有)源

离线源注意解决内部依赖、远程部署安装。包括但不限于

- 文件服务器
- yum、apt软件源
- 镜像仓
- 源码仓

你可能需要掌握但不限于

- 远程部署和执行[ansible&playbook](https://github.com/stonebirdjx/notebook/blob/master/ansible%26playbook.md)
- 文件服务器：[nginx](https://github.com/stonebirdjx/notebook/blob/master/nginx.md)、[gohttpserver](https://hub.docker.com/r/codeskyblue/gohttpserver)
- 镜像仓：[docker-registry](https://docs.docker.com/registry/)  、[habor](https://goharbor.io/)
- 代码仓：[gitlab](https://docs.gitlab.com/ee/install/docker.html)
- 软件源：[yum源配置]() 、[apt-dep包源配置]()
- k8s部署：[kubespary](https://github.com/kubernetes-sigs/kubespray)、[kubeadmin](https://kubernetes.io/docs/reference/setup-tools/kubeadm/)、[边缘计算k3s](https://github.com/stonebirdjx/k8s-ladder/blob/master/k3s-%E8%BD%BB%E9%87%8F%E5%8C%96%E7%9A%84kubenetes.md)

> 能用容器操作的请使用容器

# :point_right:高可用系统设计

高可用系统包括但不限于以下特点：

- 程序有良好的运行环境
- 能够承受高峰期的最大流量
- 能够承受部分设备宕机
- 能够承受部分设备硬件故障（磁盘、网络）
- 没有过多的资源浪费

你可能需要掌握但不限于

- 热备多机防止故障（vip、浮动ip）：[keepalived](https://github.com/stonebirdjx/notebook/blob/master/keepalived.md)
- 负载均衡：[LVS](https://github.com/stonebirdjx/notebook/blob/master/lvs.md)、[nginx](https://github.com/stonebirdjx/notebook/blob/master/nginx.md)、haproxy
- 对象存储: [minio](https://www.minio.org.cn/)
- 文件系统：ceph、nfs、glusterfs
- 数据库：redis、mysql、postgres、mongo
- 消息队列：rocketMQ、RabbitMQ

# :point_right:IAM访问控制

**IAM**是Identity and Access Management的简写。统一身份认证服务含义， 我们统称为【访问控制】

支持 JWT、OAuth2 两种标准的身份认证信息传递

支持给单一身份或一组身份分配角色权限

基于 RBAC 模型，支持资源提供方定义角色与权限

| 名词     | 解释                                                         |
| -------- | ------------------------------------------------------------ |
| 主账号   | 即注册产生的独立账号                                         |
| 子账号   | 由主账号创建的拥有主账号部分权限的账号，可以进行控制台访问或者编程访问 |
| AK/SK    | 调用OpenAPI的基本元素，每个主账号/子账号都能生成最多两队AK/SK用于编程访问，AK/SK的权限对应到账号的资源访问权限 |
| 策略     | 即资源的访问权限，设置子账号时需要关联权限，AK/SK和策略关联  |
| 角色     | 拥有一些策略集合的用户，可以将角色绑定在子用户上，子用户将拥有这个角色的所有策略 |
| 访问方式 | 包括控制台访问和编程访问，控制台访问允许登录到控制台进行操作，编程访问通过获取的AK/SK实现，用于开发人员访问资源时使用 |

**用户端**：主账号管理 

运维端：用户管理、用户组管理、策略管理、AK/SK、项目project

可以需要掌握（自行设计也是一个不错的选择）：[Casbin](https://casbin.org/zh/)

> 主账号视角有自己的 用户管理、用户组管理、策略管理、AK/SK

# :point_right:TOP网关服务

流量网关通常只专注于全局的Api管理策略，比如全局流量监控、日志记录、全局限流、黑白名单控制、接入请求到业务系统的负载均衡等，有点类似防火墙。

签名认证、鉴权、白名单、黑名单、路由、服务认证、流量控制、跨域访问、审计采集、日志数仓、监控告警。

- OpenAPI 设计规范 (API名称、显示名称、所属服务、version、更新时间、创建时间、操作)

可能需要了解：

- 服务注册与发现
- Nginx + lua 高性能架构

# :point_right:容器服务

对于集群级别：

- 主机管理
- 集群管理
- 用于对集群的权限
- helm-chart

对于集群功能：

- 节点管理(Node）
- 命名空间管理(NameSpace)
- 工作负载(Deployment、StatefulSet 、Job、CronJob、DaemonSet、pod）

- 服务管理(Service、Ingress）
- 存储管理(StorageClass、PVC、PV)
- 配置管理(ConfigMap、Secret)
- 弹性伸缩管理（HPA）
- 运维管理（组件管理、事件管理、日志、监控）
- 安全管理（基线巡检、应用巡检）

你可能需要掌握但不限于：

- 容器编排系统：[k8s](https://github.com/stonebirdjx/k8s-ladder) 、[边缘计算的k3s](https://github.com/stonebirdjx/k8s-ladder/blob/master/k3s-%E8%BD%BB%E9%87%8F%E5%8C%96%E7%9A%84kubenetes.md)

- 包管理器: [helm-chart](https://github.com/stonebirdjx/k8s-ladder/blob/master/helm.md)

- 动态存储类：rock-ceph、rock-nfs

- k8数据库：etcd

- 日志分析系统:

  - EFK：Elasticsearch，FileBeat，Kibana
  - Loki：Grafana、Promtail

- 时序数据库：[Prometheus](https://github.com/stonebirdjx/notebook/blob/master/prometheus.md)


# :point_right:观测分析

自定义监控：自定义的看板

自定义服务：服务接入

告警（集群、节点、命名空间、pod、自定义服务）：预设指标告警、自定义指标告警

![](https://github.com/stonebirdjx/static/blob/master/notebook/insight-2023-03-27-1851.png)

你可能需要掌握但不限于：

- OpenTelemetry
- Jaeger
- Prometheus
- Zipkin

# :point_right:CDN内容分发



# :point_right:应用侧

hertz、swagger、requestid 、trace、FFmpeg（ffprobe）、

